@model FAPP.ViewModel.MessagingVM
@using FAPP.DAL;

@using FAPP.Model;

@{
    ViewBag.Title = "Messaging Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section TopRightMenu{
    <ul class="minitiles">
        <li class="blue" style="margin-right:0">
            <a onclick="AddTemplateTypes()" data-toggle="tooltip" title="Add Template Types">
                <i class="fa fa-cogs"></i>
            </a>
        </li>
    </ul>
}
    <div class="alert alert-info alert-dismissable cannotAutoClose h4" style="margin-top:15px;margin-bottom:6px">
        <button type="button" class="close" data-dismiss="alert">×</button>
        
        <p style="padding-top:5px !important;">
            <strong>[<i class="fa fa-info"></i>]</strong> Messages with status <strong>Pending</strong> and <strong>Current Date</strong> will be sent only.

        </p>
    </div>
<div class="col-sm-8" style="padding: 0;margin-top: -10px;">
    <div class="box box-color grey box-bordered">
        <div class="box-title">
            <h3>
                <i class="fa fa-check-square-o"></i>
                All Sent Messages
            </h3>
            <div class="actions">
                <a href="#" class="btn btn-mini content-slideUp">
                    <i class="fa fa-angle-down"></i>
                </a>
            </div>
        </div>
        <div class="box-content">
            <div id="paiChart"></div>
            @*@Html.Action("GetDashboardMessaging", "Forms", new { area = "", mid = 1, ttid = 1 })*@
        </div>
    </div>
</div>
<div class="col-sm-4" style="padding-left: 5px;padding-right: 0;margin-top: -10px;" id="">
    <div class="box box-color box-bordered orange">
        <div class="box-title">
            <h3>
                <i class="fa fa-bars"></i>
                <span id="LabelTitle">Settings</span>
            </h3>
        </div>
        <div class="box-content">
            <table class="table table-nohead">
                <tbody>
                    <tr style="display: table-row;">
                        <td>
                            <span class="label label-default"><i class="fa fa-bars"></i></span>
                            <a href="/Messaging/Index/@SessionHelper.ModuleId">SMS Queue</a>
                        </td>
                    </tr>
                    <tr style="display: table-row;">
                        <td>
                            <span class="label label-default"><i class="fa fa-bars"></i></span>
                            <a href="/Messaging/Batch/@SessionHelper.ModuleId">SMS Batches</a>
                        </td>
                    </tr>
                    <tr style="display: table-row;">
                        <td>
                            <span class="label label-default"><i class="fa fa-bars"></i></span>
                            <a href="/Messaging/NotificationSettings/@SessionHelper.ModuleId">Notification Settings</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
@{
    var templateTypes = (List<TemplateType>)TempData["TemplateTypes"];
    string[] array = new string[] { "blue", "darkblue", "grey", "orange", "brown", "green", "red", "Purple" };
}

@{int i = 0;
    foreach (var type in templateTypes)
    {
        <div class="col-sm-8" style="padding: 0;">
            <div class="box box-color @array[i] box-bordered">
                <div class="box-title">
                    <h3>
                        <i class="fa fa-check-square-o"></i>
                        @Html.DisplayFor(m => type.TemplateTypeName)
                    </h3>
                    <div class="actions">
                        <a href="#" class="btn btn-mini content-slideUp">
                            <i class="fa fa-angle-down"></i>
                        </a>
                    </div>
                </div>
                <div class="box-content">
                    @Html.Action("GetDashboardMessaging", "Messaging", new { area = "", mid = type.ModuleId, ttid = type.TemplateTypeId })
                </div>
            </div>
        </div>
        i++;
    }
}


@section scripts{
    <script src="~/Scripts/googleChart.js"></script>
    <script type="text/javascript">

    // Load the Visualization API and the corechart package.
    google.charts.load('current', {'packages':['corechart']});

    // Set a callback to run when the Google Visualization API is loaded.
    google.charts.setOnLoadCallback(drawChart);

    // Callback that creates and populates a data table,
    // instantiates the pie chart, passes in the data and
    // draws it.
    function drawChart() {

        // Create the data table.
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Topping');
        data.addColumn('number', 'Slices');
        data.addRows([
            @foreach (var item in Model.SmsChart)
            {
                <text>['@item.Key', @item.Value],</text>
            }
        ]);
        // Set chart options
        var options =
        {
            'title': 'Sent SMS',
            'width':450,
            'height': 300,
            is3D: true,
            sliceVisibilityThreshold: 0,
            chartArea: { left: 20, top: 20, width: '100%', height: '100%' }
        };

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.PieChart(document.getElementById('paiChart'));
        chart.draw(data, options);
    }

        $('#extendedPageHeader').html('<p style="margin-top:13px"><label class="label label-green" title="Module Name">@ViewBag.ModuleName</label> </p>');
        function AddTemplateTypes()
        {
            $.ajax({
                url: '@Url.Action("AddTemplateTypes")',
                method: "POST",
                data: { id:@Model.ModuleId},
                success: onSearchSuccess,
                error: OnFailure
            });
         }
    </script>
    <script>
        var isActive = "Yes"; //string //"Yes" and "No"
        var PageType = "";//string For Child page // "HaveChild"
        var IsMenuItem = false;//bool
        var IsDashboardPart = false;//bool only for Dashboard
        var ShowOnDesktop = true;//bool for quick links
        var IsMasterMenu = false;//bool for Main Menu
        var IsQuickLink = true;//bool for quick links
        var IsAction = false;// only for button permissions


        //-----------------****------------------
        InsertInMembershipForms("Messaging", 3001, "/Messaging/Templates/14", "Messaging", 9, isActive, PageType, IsMenuItem, IsDashboardPart, ShowOnDesktop, IsMasterMenu, IsQuickLink, 14);
        //-----------------****------------------
        InsertInMembershipForms("Messaging", 201001, "/Messaging/Templates/1", "Messaging", 10, isActive, PageType, IsMenuItem, IsDashboardPart, ShowOnDesktop, IsMasterMenu, IsQuickLink, 1);
        //-----------------****------------------
        InsertInMembershipForms("Messaging", 301001, "/Messaging/Templates/7", "Messaging", 10, isActive, PageType, IsMenuItem, IsDashboardPart, ShowOnDesktop, IsMasterMenu, IsQuickLink, 7);
        //-----------------****------------------
        InsertInMembershipForms("Messaging", 5001, "/Messaging/Templates/2", "Messaging", 10, isActive, PageType, IsMenuItem, IsDashboardPart, ShowOnDesktop, IsMasterMenu, IsQuickLink, 2);
        //-----------------****------------------
        InsertInMembershipForms("Messaging", 11001, "/Messaging/Templates/9", "Messaging", 10, isActive, PageType, IsMenuItem, IsDashboardPart, ShowOnDesktop, IsMasterMenu, IsQuickLink, 9);
        //-----------------****------------------
        InsertInMembershipForms("Messaging", 8001, "/Messaging/Templates/18", "Messaging", 10, isActive, PageType, IsMenuItem, IsDashboardPart, ShowOnDesktop, IsMasterMenu, IsQuickLink, 18);
        //-----------------****------------------
        InsertInMembershipForms("Messaging", 14001, "/Messaging/Templates/13", "Messaging", 10, isActive, PageType, IsMenuItem, IsDashboardPart, ShowOnDesktop, IsMasterMenu, IsQuickLink, 13);
        //-----------------****------------------
        InsertInMembershipForms("Messaging", 19001, "/Messaging/Templates/17", "Messaging", 10, isActive, PageType, IsMenuItem, IsDashboardPart, ShowOnDesktop, IsMasterMenu, IsQuickLink, 17);
        //-----------------****------------------
        InsertInMembershipForms("Messaging", 7001, "/Messaging/Templates/41", "Messaging", 10, isActive, PageType, IsMenuItem, IsDashboardPart, ShowOnDesktop, IsMasterMenu, IsQuickLink, 41);
        //-----------------****------------------
    </script>

}